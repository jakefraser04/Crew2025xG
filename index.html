<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Columbus Crew — xG Dashboard 2025</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow:ital,wght@0,300;0,400;0,500;0,600;1,300&family=Barlow+Condensed:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --gold:     #F5C518;
    --gold-dim: #8A6D10;
    --black:    #0C0B08;
    --surface:  #161410;
    --card:     #1E1C16;
    --border:   #2E2B20;
    --muted:    #6B6650;
    --cream:    #F0EBD8;
    --win:      #27AE60;
    --draw:     #E67E22;
    --loss:     #C0392B;
  }

  html { scroll-behavior: smooth; }

  body {
    background: var(--black);
    color: var(--cream);
    font-family: 'Barlow', sans-serif;
    font-weight: 300;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* ── NOISE TEXTURE OVERLAY ── */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 0;
    opacity: 0.4;
  }

  /* ── HERO ── */
  .hero {
    position: relative;
    padding: 4rem 2rem 3rem;
    border-bottom: 1px solid var(--border);
    overflow: hidden;
  }

  .hero::after {
    content: 'xG';
    position: absolute;
    right: -2rem;
    top: -2rem;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22rem;
    color: rgba(245, 197, 24, 0.03);
    pointer-events: none;
    line-height: 1;
    user-select: none;
  }

  .hero-inner {
    max-width: 1200px;
    margin: 0 auto;
    position: relative;
    z-index: 1;
  }

  .hero-eyebrow {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 0.25em;
    color: var(--gold);
    text-transform: uppercase;
    margin-bottom: 0.75rem;
    animation: fadeUp 0.6s ease both;
  }

  .hero-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(3.5rem, 10vw, 7rem);
    line-height: 0.92;
    color: var(--cream);
    animation: fadeUp 0.6s 0.1s ease both;
  }

  .hero-title span { color: var(--gold); }

  .hero-sub {
    margin-top: 1.2rem;
    font-size: 1rem;
    color: var(--muted);
    max-width: 560px;
    line-height: 1.65;
    animation: fadeUp 0.6s 0.2s ease both;
  }

  /* ── STAT BAR ── */
  .stat-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 0;
    margin-top: 2.5rem;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
    animation: fadeUp 0.6s 0.3s ease both;
  }

  .stat {
    flex: 1;
    min-width: 130px;
    padding: 1.1rem 1.4rem;
    border-right: 1px solid var(--border);
    transition: background 0.2s;
  }

  .stat:last-child { border-right: none; }
  .stat:hover { background: rgba(245,197,24,0.04); }

  .stat-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2.2rem;
    color: var(--gold);
    line-height: 1;
  }

  .stat-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.72rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 0.3rem;
  }

  /* ── NAV ── */
  nav {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(12, 11, 8, 0.92);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    padding: 0 2rem;
  }

  .nav-inner {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    gap: 0;
  }

  .nav-link {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.82rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    text-decoration: none;
    padding: 1rem 1.2rem;
    border-bottom: 2px solid transparent;
    transition: color 0.2s, border-color 0.2s;
  }

  .nav-link:hover {
    color: var(--gold);
    border-bottom-color: var(--gold);
  }

  /* ── MAIN ── */
  main {
    max-width: 1200px;
    margin: 0 auto;
    padding: 3rem 2rem 6rem;
  }

  /* ── SECTION ── */
  .section {
    margin-bottom: 4rem;
    animation: fadeUp 0.5s ease both;
  }

  .section-header {
    display: flex;
    align-items: baseline;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border);
  }

  .section-num {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.18em;
    color: var(--gold);
    text-transform: uppercase;
  }

  .section-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    color: var(--cream);
    letter-spacing: 0.02em;
  }

  .section-desc {
    font-size: 0.9rem;
    color: var(--muted);
    margin-left: auto;
    max-width: 340px;
    text-align: right;
    line-height: 1.5;
  }

  /* ── CHART CARD ── */
  .chart-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1.5rem;
    position: relative;
    overflow: hidden;
  }

  .chart-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--gold), transparent);
  }

  .chart-wrap {
    position: relative;
    width: 100%;
  }

  /* ── IMAGE CHARTS ── */
  .img-chart {
    width: 100%;
    border-radius: 6px;
    display: block;
  }

  /* ── TWO COL GRID ── */
  .grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  @media (max-width: 768px) {
    .grid-2 { grid-template-columns: 1fr; }
    .section-desc { display: none; }
    .hero::after { display: none; }
  }

  /* ── MATCH TABLE ── */
  .table-wrap {
    overflow-x: auto;
    border-radius: 8px;
    border: 1px solid var(--border);
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.88rem;
  }

  thead tr {
    background: var(--surface);
    border-bottom: 1px solid var(--border);
  }

  th {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--gold);
    padding: 0.85rem 1rem;
    text-align: left;
    white-space: nowrap;
  }

  tbody tr {
    border-bottom: 1px solid var(--border);
    transition: background 0.15s;
  }

  tbody tr:last-child { border-bottom: none; }
  tbody tr:hover { background: rgba(245,197,24,0.03); }

  td {
    padding: 0.75rem 1rem;
    color: var(--cream);
    white-space: nowrap;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 26px; height: 26px;
    border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.8rem;
    font-weight: 600;
  }

  .badge-W { background: rgba(39,174,96,0.2);  color: var(--win);  }
  .badge-D { background: rgba(230,126,34,0.2); color: var(--draw); }
  .badge-L { background: rgba(192,57,43,0.2);  color: var(--loss); }

  .xg-bar-wrap {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .xg-bar {
    height: 6px;
    border-radius: 3px;
    background: var(--gold);
    min-width: 2px;
  }

  .xg-bar.against { background: var(--loss); }

  .undeserved {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    letter-spacing: 0.08em;
    padding: 0.15em 0.5em;
    border-radius: 3px;
    background: rgba(245,197,24,0.15);
    color: var(--gold);
    text-transform: uppercase;
  }

  /* ── INSIGHTS ── */
  .insights-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }

  @media (max-width: 768px) {
    .insights-grid { grid-template-columns: 1fr; }
  }

  .insight-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1.4rem;
    position: relative;
  }

  .insight-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: var(--gold);
    border-radius: 10px 10px 0 0;
  }

  .insight-num {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 3rem;
    color: var(--gold);
    line-height: 1;
  }

  .insight-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 0.2rem;
    margin-bottom: 0.75rem;
  }

  .insight-text {
    font-size: 0.88rem;
    color: var(--cream);
    line-height: 1.6;
    opacity: 0.85;
  }

  /* ── FOOTER ── */
  footer {
    border-top: 1px solid var(--border);
    padding: 2rem;
    text-align: center;
  }

  .footer-inner {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 1rem;
  }

  .footer-text {
    font-size: 0.8rem;
    color: var(--muted);
  }

  .footer-text a {
    color: var(--gold);
    text-decoration: none;
  }

  .footer-text a:hover { text-decoration: underline; }

  /* ── LOADING ── */
  .loading {
    text-align: center;
    padding: 3rem;
    color: var(--muted);
    font-family: 'Barlow Condensed', sans-serif;
    letter-spacing: 0.1em;
    font-size: 0.85rem;
  }

  /* ── ANIMATIONS ── */
  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  .section:nth-child(1) { animation-delay: 0.05s; }
  .section:nth-child(2) { animation-delay: 0.1s; }
  .section:nth-child(3) { animation-delay: 0.15s; }
  .section:nth-child(4) { animation-delay: 0.2s; }
  .section:nth-child(5) { animation-delay: 0.25s; }
</style>
</head>
<body>

<!-- ── HERO ────────────────────────────────────────── -->
<section class="hero">
  <div class="hero-inner">
    <div class="hero-eyebrow">Columbus Crew SC · 2025 MLS Season · xG Analysis</div>
    <h1 class="hero-title">Did They<br><span>Deserve</span><br>It?</h1>
    <p class="hero-sub">
      A match-by-match Expected Goals analysis of the Columbus Crew's 2025 MLS season.
      Built with a logistic regression xG model trained on StatsBomb open data,
      applied to American Soccer Analysis match data.
    </p>
    <div class="stat-bar" id="stat-bar">
      <div class="stat"><div class="stat-value" id="stat-record">—</div><div class="stat-label">Season Record</div></div>
      <div class="stat"><div class="stat-value" id="stat-xg-for">—</div><div class="stat-label">Total xG For</div></div>
      <div class="stat"><div class="stat-value" id="stat-xg-ag">—</div><div class="stat-label">Total xG Against</div></div>
      <div class="stat"><div class="stat-value" id="stat-goals">—</div><div class="stat-label">Actual Goals</div></div>
      <div class="stat"><div class="stat-value" id="stat-lucky">—</div><div class="stat-label">Lucky Wins</div></div>
      <div class="stat"><div class="stat-value" id="stat-unlucky">—</div><div class="stat-label">Unlucky Losses</div></div>
    </div>
  </div>
</section>

<!-- ── NAV ─────────────────────────────────────────── -->
<nav>
  <div class="nav-inner">
    <a href="#trend"       class="nav-link">xG Trend</a>
    <a href="#differential" class="nav-link">Differential</a>
    <a href="#form"        class="nav-link">Form</a>
    <a href="#breakdown"   class="nav-link">Home / Away</a>
    <a href="#matches"     class="nav-link">All Matches</a>
    <a href="#insights"    class="nav-link">Insights</a>
  </div>
</nav>

<!-- ── MAIN ────────────────────────────────────────── -->
<main>

  <!-- Section 1: xG Trend -->
  <section class="section" id="trend">
    <div class="section-header">
      <span class="section-num">01</span>
      <h2 class="section-title">Cumulative xG vs Actual Goals</h2>
      <p class="section-desc">The gap between lines reveals luck vs quality over the season</p>
    </div>
    <div class="chart-card">
      <img src="../assets/xg_trend.png" alt="xG Trend" class="img-chart" id="img-trend">
    </div>
  </section>

  <!-- Section 2: Differential -->
  <section class="section" id="differential">
    <div class="section-header">
      <span class="section-num">02</span>
      <h2 class="section-title">Match-by-Match xG Differential</h2>
      <p class="section-desc">Positive = dominated the match. * = result didn't match xG.</p>
    </div>
    <div class="chart-card">
      <img src="../assets/xg_differential.png" alt="xG Differential" class="img-chart">
    </div>
  </section>

  <!-- Section 3: Rolling Form -->
  <section class="section" id="form">
    <div class="section-header">
      <span class="section-num">03</span>
      <h2 class="section-title">Rolling 5-Match xG Form</h2>
      <p class="section-desc">Momentum indicator — when were the Crew dominant?</p>
    </div>
    <div class="chart-card">
      <img src="../assets/rolling_xg_form.png" alt="Rolling Form" class="img-chart">
    </div>
  </section>

  <!-- Section 4: Home/Away + Heatmap -->
  <section class="section" id="breakdown">
    <div class="section-header">
      <span class="section-num">04</span>
      <h2 class="section-title">Home · Away · Shot Quality</h2>
      <p class="section-desc">Home/Away xG scatter and model probability heatmap</p>
    </div>
    <div class="grid-2">
      <div class="chart-card">
        <img src="../assets/home_away_xg.png" alt="Home Away" class="img-chart">
      </div>
      <div class="chart-card">
        <img src="../assets/xg_heatmap.png" alt="xG Heatmap" class="img-chart">
      </div>
    </div>
  </section>

  <!-- Section 5: Match Table -->
  <section class="section" id="matches">
    <div class="section-header">
      <span class="section-num">05</span>
      <h2 class="section-title">All Matches</h2>
      <p class="section-desc">Full season log with xG values and result verdict</p>
    </div>
    <div class="chart-card">
      <div class="table-wrap">
        <table id="match-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Opponent</th>
              <th>Venue</th>
              <th>Result</th>
              <th>Score</th>
              <th>xG For</th>
              <th>xG Ag</th>
              <th>xG Diff</th>
              <th>Verdict</th>
            </tr>
          </thead>
          <tbody id="match-tbody">
            <tr><td colspan="9" class="loading">Loading match data...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- Section 6: Insights -->
  <section class="section" id="insights">
    <div class="section-header">
      <span class="section-num">06</span>
      <h2 class="section-title">Key Insights</h2>
      <p class="section-desc">What the xG data tells us about the 2025 season</p>
    </div>
    <div class="insights-grid" id="insights-grid">
      <div class="loading">Loading...</div>
    </div>
  </section>

</main>

<!-- ── FOOTER ───────────────────────────────────────── -->
<footer>
  <div class="footer-inner">
    <p class="footer-text">
      Built by <strong>Jake F.</strong> · xG model trained on
      <a href="https://github.com/statsbomb/open-data" target="_blank">StatsBomb open data</a> ·
      Match data via <a href="https://www.americansocceranalysis.com" target="_blank">American Soccer Analysis</a>
    </p>
    <p class="footer-text">
      <a href="https://github.com/jakef/crew-xg-dashboard" target="_blank">View on GitHub →</a>
    </p>
  </div>
</footer>

<script>
// ── Load JSON data ────────────────────────────────────────
async function loadData() {
  try {
    const [matchRes, summaryRes] = await Promise.all([
      fetch('../dashboard/data/match_xg.json'),
      fetch('../dashboard/data/season_summary.json')
    ]);

    const matches = await matchRes.json();
    const summary = await summaryRes.json();

    renderStatBar(summary);
    renderMatchTable(matches);
    renderInsights(summary, matches);

  } catch (err) {
    console.error('Failed to load data:', err);
    document.getElementById('match-tbody').innerHTML =
      '<tr><td colspan="9" class="loading">Could not load data. Make sure dashboard/data/ JSON files exist.</td></tr>';
  }
}


// ── Stat Bar ──────────────────────────────────────────────
function renderStatBar(s) {
  document.getElementById('stat-record').textContent  = `${s.wins}W ${s.draws}D ${s.losses}L`;
  document.getElementById('stat-xg-for').textContent  = s.total_xg_for.toFixed(1);
  document.getElementById('stat-xg-ag').textContent   = s.total_xg_ag.toFixed(1);
  document.getElementById('stat-goals').textContent   = s.total_goals;
  document.getElementById('stat-lucky').textContent   = s.lucky_wins;
  document.getElementById('stat-unlucky').textContent = s.unlucky_losses;
}


// ── Match Table ───────────────────────────────────────────
function renderMatchTable(matches) {
  const maxXg = Math.max(...matches.map(m => Math.max(m.xg_for, m.xg_ag)));

  const rows = matches.map(m => {
    const forPct  = (m.xg_for / maxXg * 120).toFixed(0);
    const agPct   = (m.xg_ag  / maxXg * 120).toFixed(0);
    const diff    = m.xg_diff >= 0
      ? `<span style="color:var(--win)">+${m.xg_diff.toFixed(2)}</span>`
      : `<span style="color:var(--loss)">${m.xg_diff.toFixed(2)}</span>`;

    const verdict = m.deserved
      ? ''
      : `<span class="undeserved">${m.result === 'W' ? 'Lucky W' : 'Unlucky L'}</span>`;

    return `
      <tr>
        <td style="color:var(--muted);font-size:0.82rem">${m.date}</td>
        <td style="font-weight:500">${m.opponent}</td>
        <td style="color:var(--muted);font-size:0.82rem">${m.venue}</td>
        <td><span class="badge badge-${m.result}">${m.result}</span></td>
        <td>${m.goals_for}–${m.goals_ag}</td>
        <td>
          <div class="xg-bar-wrap">
            <div class="xg-bar" style="width:${forPct}px"></div>
            <span style="font-size:0.82rem">${m.xg_for.toFixed(2)}</span>
          </div>
        </td>
        <td>
          <div class="xg-bar-wrap">
            <div class="xg-bar against" style="width:${agPct}px"></div>
            <span style="font-size:0.82rem">${m.xg_ag.toFixed(2)}</span>
          </div>
        </td>
        <td>${diff}</td>
        <td>${verdict}</td>
      </tr>
    `;
  }).join('');

  document.getElementById('match-tbody').innerHTML = rows;
}


// ── Insights ──────────────────────────────────────────────
function renderInsights(s, matches) {
  const avgXgFor = (s.total_xg_for / s.matches).toFixed(2);
  const avgXgAg  = (s.total_xg_ag  / s.matches).toFixed(2);
  const xgDiff   = (s.total_xg_for - s.total_xg_ag).toFixed(2);
  const overUnder = (s.total_goals - s.total_xg_for).toFixed(2);
  const overLabel = overUnder >= 0 ? `+${overUnder} above` : `${overUnder} below`;

  const bestMatch = matches.reduce((a, b) => a.xg_diff > b.xg_diff ? a : b);
  const worstMatch = matches.reduce((a, b) => a.xg_diff < b.xg_diff ? a : b);

  const html = `
    <div class="insight-card">
      <div class="insight-num">${avgXgFor}</div>
      <div class="insight-label">Avg xG Per Game</div>
      <p class="insight-text">
        The Crew averaged ${avgXgFor} xG per match offensively and conceded
        ${avgXgAg} xG per game defensively — a season xG differential of
        ${xgDiff >= 0 ? '+' : ''}${xgDiff}.
      </p>
    </div>
    <div class="insight-card">
      <div class="insight-num">${overLabel.split(' ')[0]}</div>
      <div class="insight-label">Goals vs xG</div>
      <p class="insight-text">
        The Crew scored ${s.total_goals} goals on ${s.total_xg_for} total xG —
        ${overLabel} their expected output. This measures finishing quality and
        goalkeeper luck across the season.
      </p>
    </div>
    <div class="insight-card">
      <div class="insight-num">${s.lucky_wins + s.unlucky_losses}</div>
      <div class="insight-label">Undeserved Results</div>
      <p class="insight-text">
        ${s.lucky_wins} wins came when xG favored the opponent.
        ${s.unlucky_losses} losses came when xG favored the Crew.
        ${s.deserved_pct}% of results matched what the xG data suggested.
      </p>
    </div>
    <div class="insight-card">
      <div class="insight-num">${bestMatch.xg_diff.toFixed(2)}</div>
      <div class="insight-label">Best xG Performance</div>
      <p class="insight-text">
        The Crew's most dominant performance by xG differential was
        vs <strong>${bestMatch.opponent}</strong> (${bestMatch.date}),
        with an xG For of ${bestMatch.xg_for.toFixed(2)} vs ${bestMatch.xg_ag.toFixed(2)} Against.
      </p>
    </div>
    <div class="insight-card">
      <div class="insight-num">${worstMatch.xg_diff.toFixed(2)}</div>
      <div class="insight-label">Worst xG Performance</div>
      <p class="insight-text">
        The most one-sided game against the Crew was
        vs <strong>${worstMatch.opponent}</strong> (${worstMatch.date}),
        where they generated just ${worstMatch.xg_for.toFixed(2)} xG
        and conceded ${worstMatch.xg_ag.toFixed(2)} xG.
      </p>
    </div>
    <div class="insight-card">
      <div class="insight-num">${s.deserved_pct}%</div>
      <div class="insight-label">Results Matched xG</div>
      <p class="insight-text">
        Across ${s.matches} matches, ${s.deserved_pct}% of results aligned
        with what the xG model predicted. This is a measure of how much
        variance (luck) played a role in the Crew's 2025 season.
      </p>
    </div>
  `;

  document.getElementById('insights-grid').innerHTML = html;
}

// ── Init ──────────────────────────────────────────────────
loadData();
</script>
</body>
</html>
