<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Columbus Crew — xG Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow:wght@300;400;500&family=Barlow+Condensed:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --gold:    #F5C518;
    --black:   #0C0B08;
    --surface: #161410;
    --card:    #1E1C16;
    --border:  #2E2B20;
    --muted:   #6B6650;
    --cream:   #F0EBD8;
    --win:     #27AE60;
    --draw:    #E67E22;
    --loss:    #C0392B;
  }

  html { scroll-behavior: smooth; }

  body {
    background: var(--black);
    color: var(--cream);
    font-family: 'Barlow', sans-serif;
    font-weight: 300;
    min-height: 100vh;
  }

  /* ── HERO ── */
  .hero {
    padding: 4rem 2rem 3rem;
    border-bottom: 1px solid var(--border);
    position: relative;
    overflow: hidden;
  }

  .hero::after {
    content: 'xG';
    position: absolute;
    right: -2rem; top: -2rem;
    font-family: 'Bebas Neue', sans-serif;
    font-size: 22rem;
    color: rgba(245,197,24,0.03);
    pointer-events: none;
    line-height: 1;
  }

  .hero-inner { max-width: 1200px; margin: 0 auto; position: relative; z-index: 1; }

  .eyebrow {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    letter-spacing: 0.25em;
    color: var(--gold);
    text-transform: uppercase;
    margin-bottom: 0.75rem;
  }

  h1 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(3.5rem, 10vw, 7rem);
    line-height: 0.92;
    color: var(--cream);
  }

  h1 span { color: var(--gold); }

  .hero-sub {
    margin-top: 1.2rem;
    font-size: 1rem;
    color: var(--muted);
    max-width: 560px;
    line-height: 1.65;
  }

  /* ── SEASON TOGGLE ── */
  /* This is the key new UI element — lets users switch between 2025 and 2026 */
  .season-toggle {
    display: inline-flex;
    margin-top: 2rem;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
  }

  .season-btn {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    padding: 0.6rem 1.6rem;
    background: transparent;
    color: var(--muted);
    border: none;
    cursor: pointer;
    transition: all 0.2s;
  }

  /* .active class is added by JavaScript when a season is selected */
  .season-btn.active {
    background: var(--gold);
    color: var(--black);
  }

  .season-btn:hover:not(.active) {
    background: rgba(245,197,24,0.08);
    color: var(--cream);
  }

  /* ── STAT BAR ── */
  .stat-bar {
    display: flex;
    flex-wrap: wrap;
    margin-top: 2rem;
    border: 1px solid var(--border);
    border-radius: 8px;
    overflow: hidden;
  }

  .stat {
    flex: 1;
    min-width: 120px;
    padding: 1rem 1.4rem;
    border-right: 1px solid var(--border);
    transition: background 0.2s;
  }

  .stat:last-child { border-right: none; }
  .stat:hover { background: rgba(245,197,24,0.04); }

  .stat-value {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 2rem;
    color: var(--gold);
    line-height: 1;
  }

  .stat-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
    margin-top: 0.3rem;
  }

  /* ── NAV ── */
  nav {
    position: sticky; top: 0; z-index: 100;
    background: rgba(12,11,8,0.92);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    padding: 0 2rem;
  }

  .nav-inner {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
  }

  .nav-link {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.82rem;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    color: var(--muted);
    text-decoration: none;
    padding: 1rem 1.2rem;
    border-bottom: 2px solid transparent;
    transition: color 0.2s, border-color 0.2s;
  }

  .nav-link:hover { color: var(--gold); border-bottom-color: var(--gold); }

  /* ── MAIN ── */
  main { max-width: 1200px; margin: 0 auto; padding: 3rem 2rem 6rem; }

  .section { margin-bottom: 4rem; }

  .section-header {
    display: flex;
    align-items: baseline;
    gap: 1rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid var(--border);
  }

  .section-num {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.18em;
    color: var(--gold);
    text-transform: uppercase;
  }

  .section-title {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.8rem;
    color: var(--cream);
  }

  .section-desc {
    font-size: 0.88rem;
    color: var(--muted);
    margin-left: auto;
    max-width: 340px;
    text-align: right;
    line-height: 1.5;
  }

  /* ── CARDS ── */
  .chart-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 1.5rem;
    position: relative;
    overflow: hidden;
  }

  .chart-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
    background: linear-gradient(90deg, var(--gold), transparent);
  }

  .img-chart { width: 100%; border-radius: 6px; display: block; }

  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; }

  /* ── NO DATA STATE ── */
  /* Shown when 2026 data hasn't been loaded yet */
  .no-data {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--muted);
  }

  .no-data-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.4;
  }

  .no-data h3 {
    font-family: 'Bebas Neue', sans-serif;
    font-size: 1.5rem;
    color: var(--cream);
    margin-bottom: 0.5rem;
  }

  .no-data p {
    font-size: 0.9rem;
    line-height: 1.6;
    max-width: 400px;
    margin: 0 auto;
  }

  .no-data code {
    background: var(--border);
    padding: 0.15em 0.4em;
    border-radius: 4px;
    font-size: 0.85rem;
    color: var(--gold);
  }

  /* ── MATCH TABLE ── */
  .table-wrap { overflow-x: auto; border-radius: 8px; border: 1px solid var(--border); }

  table { width: 100%; border-collapse: collapse; font-size: 0.88rem; }

  thead tr { background: var(--surface); border-bottom: 1px solid var(--border); }

  th {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--gold);
    padding: 0.85rem 1rem;
    text-align: left;
    white-space: nowrap;
  }

  tbody tr { border-bottom: 1px solid var(--border); transition: background 0.15s; }
  tbody tr:last-child { border-bottom: none; }
  tbody tr:hover { background: rgba(245,197,24,0.03); }
  td { padding: 0.75rem 1rem; color: var(--cream); white-space: nowrap; }

  .badge {
    display: inline-flex; align-items: center; justify-content: center;
    width: 26px; height: 26px; border-radius: 4px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.8rem; font-weight: 600;
  }

  .badge-W { background: rgba(39,174,96,0.2);  color: var(--win); }
  .badge-D { background: rgba(230,126,34,0.2); color: var(--draw); }
  .badge-L { background: rgba(192,57,43,0.2);  color: var(--loss); }

  .xg-bar-wrap { display: flex; align-items: center; gap: 0.5rem; }
  .xg-bar { height: 6px; border-radius: 3px; background: var(--gold); min-width: 2px; }
  .xg-bar.against { background: var(--loss); }

  .undeserved {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem; letter-spacing: 0.08em;
    padding: 0.15em 0.5em; border-radius: 3px;
    background: rgba(245,197,24,0.15); color: var(--gold);
    text-transform: uppercase;
  }

  /* ── INSIGHTS ── */
  .insights-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }

  .insight-card {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 10px; padding: 1.4rem; position: relative;
  }

  .insight-card::before {
    content: ''; position: absolute;
    top: 0; left: 0; right: 0; height: 2px;
    background: var(--gold); border-radius: 10px 10px 0 0;
  }

  .insight-num { font-family: 'Bebas Neue', sans-serif; font-size: 3rem; color: var(--gold); line-height: 1; }
  .insight-label { font-family: 'Barlow Condensed', sans-serif; font-size: 0.75rem; letter-spacing: 0.12em; text-transform: uppercase; color: var(--muted); margin: 0.2rem 0 0.75rem; }
  .insight-text { font-size: 0.88rem; color: var(--cream); line-height: 1.6; opacity: 0.85; }

  /* ── FOOTER ── */
  footer { border-top: 1px solid var(--border); padding: 2rem; }
  .footer-inner { max-width: 1200px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
  .footer-text { font-size: 0.8rem; color: var(--muted); }
  .footer-text a { color: var(--gold); text-decoration: none; }
  .footer-text a:hover { text-decoration: underline; }

  @media (max-width: 768px) {
    .grid-2 { grid-template-columns: 1fr; }
    .insights-grid { grid-template-columns: 1fr; }
    .section-desc { display: none; }
  }
</style>
</head>
<body>

<section class="hero">
  <div class="hero-inner">
    <div class="eyebrow">Columbus Crew SC · xG Season Analysis</div>
    <h1>Did They<br><span>Deserve</span><br>It?</h1>
    <p class="hero-sub">
      A match-by-match Expected Goals analysis built with a logistic regression
      model trained on StatsBomb data, applied to American Soccer Analysis match data.
    </p>

    <!-- Season Toggle -->
    <div class="season-toggle">
      <button class="season-btn" onclick="setSeason('2025')" id="btn-2025">2025</button>
      <button class="season-btn active" onclick="setSeason('2026')" id="btn-2026">2026</button>
    </div>

    <!-- Stat Bar — populated by JavaScript -->
    <div class="stat-bar">
      <div class="stat"><div class="stat-value" id="stat-record">—</div><div class="stat-label">Record</div></div>
      <div class="stat"><div class="stat-value" id="stat-xg-for">—</div><div class="stat-label">Total xG For</div></div>
      <div class="stat"><div class="stat-value" id="stat-xg-ag">—</div><div class="stat-label">Total xG Against</div></div>
      <div class="stat"><div class="stat-value" id="stat-goals">—</div><div class="stat-label">Actual Goals</div></div>
      <div class="stat"><div class="stat-value" id="stat-lucky">—</div><div class="stat-label">Lucky Wins</div></div>
      <div class="stat"><div class="stat-value" id="stat-unlucky">—</div><div class="stat-label">Unlucky Losses</div></div>
    </div>
  </div>
</section>

<nav>
  <div class="nav-inner">
    <a href="#trend"        class="nav-link">xG Trend</a>
    <a href="#differential" class="nav-link">Differential</a>
    <a href="#form"         class="nav-link">Form</a>
    <a href="#breakdown"    class="nav-link">Home / Away</a>
    <a href="#matches"      class="nav-link">All Matches</a>
    <a href="#insights"     class="nav-link">Insights</a>
  </div>
</nav>

<main>
  <section class="section" id="trend">
    <div class="section-header">
      <span class="section-num">01</span>
      <h2 class="section-title">Cumulative xG vs Actual Goals</h2>
      <p class="section-desc">The gap between lines reveals luck vs quality over the season</p>
    </div>
    <div class="chart-card">
      <img id="img-trend" class="img-chart" alt="xG Trend">
    </div>
  </section>

  <section class="section" id="differential">
    <div class="section-header">
      <span class="section-num">02</span>
      <h2 class="section-title">Match-by-Match xG Differential</h2>
      <p class="section-desc">Positive = dominated. * = result didn't match xG.</p>
    </div>
    <div class="chart-card">
      <img id="img-diff" class="img-chart" alt="xG Differential">
    </div>
  </section>

  <section class="section" id="form">
    <div class="section-header">
      <span class="section-num">03</span>
      <h2 class="section-title">Rolling 5-Match xG Form</h2>
      <p class="section-desc">Momentum indicator — when were the Crew dominant?</p>
    </div>
    <div class="chart-card">
      <img id="img-form" class="img-chart" alt="Rolling Form">
    </div>
  </section>

  <section class="section" id="breakdown">
    <div class="section-header">
      <span class="section-num">04</span>
      <h2 class="section-title">Home · Away · Shot Quality</h2>
      <p class="section-desc">Home/Away xG scatter and model probability heatmap</p>
    </div>
    <div class="grid-2">
      <div class="chart-card"><img id="img-homeaway" class="img-chart" alt="Home Away"></div>
      <div class="chart-card"><img id="img-heatmap" class="img-chart" alt="xG Heatmap"></div>
    </div>
  </section>

  <section class="section" id="matches">
    <div class="section-header">
      <span class="section-num">05</span>
      <h2 class="section-title">All Matches</h2>
      <p class="section-desc">Full season log with xG values and result verdict</p>
    </div>
    <div class="chart-card">
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>Date</th><th>Opponent</th><th>Venue</th><th>Result</th>
              <th>Score</th><th>xG For</th><th>xG Ag</th><th>xG Diff</th><th>Verdict</th>
            </tr>
          </thead>
          <tbody id="match-tbody"></tbody>
        </table>
      </div>
    </div>
  </section>

  <section class="section" id="insights">
    <div class="section-header">
      <span class="section-num">06</span>
      <h2 class="section-title">Key Insights</h2>
      <p class="section-desc">What the xG data tells us about this season</p>
    </div>
    <div class="insights-grid" id="insights-grid"></div>
  </section>
</main>

<footer>
  <div class="footer-inner">
    <p class="footer-text">
      Built by <strong>Jake Fraser</strong> ·
      xG model trained on <a href="https://github.com/statsbomb/open-data" target="_blank">StatsBomb open data</a> ·
      Match data via <a href="https://www.americansocceranalysis.com" target="_blank">American Soccer Analysis</a>
    </p>
    <p class="footer-text">
      <a href="https://github.com/jakefraser04/Crew2025xG" target="_blank">View on GitHub →</a>
    </p>
  </div>
</footer>

<script>
// ── State ─────────────────────────────────────────────────
// currentSeason tracks which season the user is viewing
let currentSeason = '2026';


// ── setSeason() ───────────────────────────────────────────
// Called when user clicks a season button.
// Updates the active button style, then loads that season's data.
function setSeason(season) {
  currentSeason = season;

  // Remove 'active' class from all buttons
  document.querySelectorAll('.season-btn').forEach(btn => {
    btn.classList.remove('active');
  });

  // Add 'active' class to the clicked button
  document.getElementById(`btn-${season}`).classList.add('active');

  // Load data for the selected season
  loadSeason(season);
}


// ── loadSeason() ──────────────────────────────────────────
// Fetches JSON data for a given season and renders everything.
// async/await lets us wait for fetch() to finish before continuing.
async function loadSeason(season) {

  // Update chart images immediately — src swap is instant
  // The image path uses the season folder we created
  document.getElementById('img-trend').src    = `assets/${season}/xg_trend.png`;
  document.getElementById('img-diff').src     = `assets/${season}/xg_differential.png`;
  document.getElementById('img-form').src     = `assets/${season}/rolling_xg_form.png`;
  document.getElementById('img-homeaway').src = `assets/${season}/home_away_xg.png`;
  document.getElementById('img-heatmap').src  = `assets/${season}/xg_heatmap.png`;

  try {
    // fetch() makes an HTTP request to load a file
    // await pauses here until the response arrives
    const [matchRes, summaryRes] = await Promise.all([
      fetch(`dashboard/data/${season}/match_xg.json`),
      fetch(`dashboard/data/${season}/season_summary.json`)
    ]);
    // Promise.all() runs both fetches at the same time (faster than sequential)

    // .json() parses the response body as JSON
    const matches = await matchRes.json();
    const summary = await summaryRes.json();

    renderStatBar(summary);
    renderMatchTable(matches);
    renderInsights(summary, matches);

  } catch (err) {
    // catch() runs if anything above throws an error (e.g. file not found)
    showNoData(season);
  }
}


// ── showNoData() ──────────────────────────────────────────
// Displays a friendly message when a season has no data yet.
function showNoData(season) {
  // Reset stat bar to dashes
  ['stat-record','stat-xg-for','stat-xg-ag','stat-goals','stat-lucky','stat-unlucky']
    .forEach(id => document.getElementById(id).textContent = '—');

  // Show no-data message in the table
  document.getElementById('match-tbody').innerHTML = `
    <tr>
      <td colspan="9">
        <div class="no-data">
          <div class="no-data-icon">⚽</div>
          <h3>No ${season} Data Yet</h3>
          <p>
            After the first match, run:<br>
            <code>python update_season.py --season ${season} --push</code>
          </p>
        </div>
      </td>
    </tr>`;

  document.getElementById('insights-grid').innerHTML = '';
}


// ── renderStatBar() ───────────────────────────────────────
// Populates the six headline stats at the top of the page.
function renderStatBar(s) {
  // textContent sets the visible text of an element
  document.getElementById('stat-record').textContent  = `${s.wins}W ${s.draws}D ${s.losses}L`;
  document.getElementById('stat-xg-for').textContent  = s.total_xg_for.toFixed(1);
  document.getElementById('stat-xg-ag').textContent   = s.total_xg_ag.toFixed(1);
  document.getElementById('stat-goals').textContent   = s.total_goals;
  document.getElementById('stat-lucky').textContent   = s.lucky_wins;
  document.getElementById('stat-unlucky').textContent = s.unlucky_losses;
}


// ── renderMatchTable() ────────────────────────────────────
// Builds the HTML table rows from match data.
function renderMatchTable(matches) {
  // Find the highest xG value across all matches (used to scale the bars)
  const maxXg = Math.max(...matches.map(m => Math.max(m.xg_for, m.xg_ag)));

  // .map() transforms each match into an HTML string
  // Template literals (backticks) let us embed variables with ${}
  const rows = matches.map(m => {
    const forWidth = (m.xg_for / maxXg * 100).toFixed(0);
    const agWidth  = (m.xg_ag  / maxXg * 100).toFixed(0);

    // Ternary operator: condition ? value_if_true : value_if_false
    const diffColor = m.xg_diff >= 0 ? 'var(--win)' : 'var(--loss)';
    const diffSign  = m.xg_diff >= 0 ? '+' : '';
    const verdict   = m.deserved ? '' :
      `<span class="undeserved">${m.result === 'W' ? 'Lucky W' : 'Unlucky L'}</span>`;

    return `
      <tr>
        <td style="color:var(--muted);font-size:0.82rem">${m.date}</td>
        <td style="font-weight:500">${m.opponent}</td>
        <td style="color:var(--muted);font-size:0.82rem">${m.venue}</td>
        <td><span class="badge badge-${m.result}">${m.result}</span></td>
        <td>${m.goals_for}–${m.goals_ag}</td>
        <td>
          <div class="xg-bar-wrap">
            <div class="xg-bar" style="width:${forWidth}px"></div>
            <span style="font-size:0.82rem">${m.xg_for.toFixed(2)}</span>
          </div>
        </td>
        <td>
          <div class="xg-bar-wrap">
            <div class="xg-bar against" style="width:${agWidth}px"></div>
            <span style="font-size:0.82rem">${m.xg_ag.toFixed(2)}</span>
          </div>
        </td>
        <td><span style="color:${diffColor}">${diffSign}${m.xg_diff.toFixed(2)}</span></td>
        <td>${verdict}</td>
      </tr>`;
  }).join('');  // .join('') combines all strings into one with no separator

  document.getElementById('match-tbody').innerHTML = rows;
}


// ── renderInsights() ─────────────────────────────────────
// Generates the six insight cards from season summary data.
function renderInsights(s, matches) {
  const avgFor    = (s.total_xg_for / s.matches).toFixed(2);
  const avgAg     = (s.total_xg_ag  / s.matches).toFixed(2);
  const overUnder = (s.total_goals - s.total_xg_for).toFixed(2);
  const sign      = overUnder >= 0 ? '+' : '';

  // .reduce() finds the match with the highest/lowest xg_diff
  const best  = matches.reduce((a, b) => a.xg_diff > b.xg_diff ? a : b);
  const worst = matches.reduce((a, b) => a.xg_diff < b.xg_diff ? a : b);

  document.getElementById('insights-grid').innerHTML = `
    <div class="insight-card">
      <div class="insight-num">${avgFor}</div>
      <div class="insight-label">Avg xG Per Game</div>
      <p class="insight-text">The Crew averaged ${avgFor} xG offensively and conceded ${avgAg} xG per game. Season xG differential: ${(s.total_xg_for - s.total_xg_ag).toFixed(2) >= 0 ? '+' : ''}${(s.total_xg_for - s.total_xg_ag).toFixed(2)}.</p>
    </div>
    <div class="insight-card">
      <div class="insight-num">${sign}${overUnder}</div>
      <div class="insight-label">Goals vs xG</div>
      <p class="insight-text">The Crew scored ${s.total_goals} goals on ${s.total_xg_for} xG — ${sign}${overUnder} ${overUnder >= 0 ? 'above' : 'below'} expected. This reflects finishing quality and goalkeeper fortune.</p>
    </div>
    <div class="insight-card">
      <div class="insight-num">${s.lucky_wins + s.unlucky_losses}</div>
      <div class="insight-label">Undeserved Results</div>
      <p class="insight-text">${s.lucky_wins} wins came when xG favored the opponent. ${s.unlucky_losses} losses came when xG favored the Crew. ${s.deserved_pct}% of results matched xG.</p>
    </div>
    <div class="insight-card">
      <div class="insight-num">+${best.xg_diff.toFixed(2)}</div>
      <div class="insight-label">Best Performance</div>
      <p class="insight-text">Most dominant by xG: vs <strong>${best.opponent}</strong> (${best.date}) — ${best.xg_for.toFixed(2)} xG for vs ${best.xg_ag.toFixed(2)} against.</p>
    </div>
    <div class="insight-card">
      <div class="insight-num">${worst.xg_diff.toFixed(2)}</div>
      <div class="insight-label">Worst Performance</div>
      <p class="insight-text">Most one-sided against: vs <strong>${worst.opponent}</strong> (${worst.date}) — ${worst.xg_for.toFixed(2)} xG for vs ${worst.xg_ag.toFixed(2)} against.</p>
    </div>
    <div class="insight-card">
      <div class="insight-num">${s.deserved_pct}%</div>
      <div class="insight-label">Results Matched xG</div>
      <p class="insight-text">Across ${s.matches} matches, ${s.deserved_pct}% of results aligned with xG predictions — a measure of how much variance played a role this season.</p>
    </div>`;
}


// ── Init ──────────────────────────────────────────────────
// When the page loads, show 2026 by default.
// If 2026 has no data, it shows the no-data state automatically.
loadSeason('2026');
</script>
</body>
</html>
